<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="fragments/admin/head :: head">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/2.5.0/remixicon.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <div th:insert="fragments/admin/header :: header"></div>
    <div th:insert="fragments/admin/sidebar :: aside"></div>

    <main id="main" class="main" style="min-height: 100vh;">
        <div class="pagetitle">
            <h1>My Spring</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item active">Dashboard</li>
                </ol>
            </nav>
        </div>
        <div class="row">
            <p th:if="${message}" th:text="${message}" style="text-align: center;" class="bg-info"></p>
            <div class="row">
                <div class="col-md-3">
                    <div class="card mb-3 text-center shadow">
                        <div class="card-header">
                        </i>Listes offres</h3>
                    </div>
                        <div class="card-body">
                            <div class="display-6 fw-bold text-dark" th:text="${offerCount}"></div>
                        </div>
                        <div class="card-footer bg-light">
                            <a th:href="@{/offers/details}" class="btn w-100">
                                Voir DÃ©tails
                            </a>
                        </div>
                    </div>
                </div>
            
                <div class="col-md-3">
                    <div class="card mb-3 text-center shadow">
                        <div class="card-header">
                            </i>Listes Factures</h3>
                        </div>
                        <div class="card-body">
                            <div class="display-6 fw-bold text-dark" th:text="${invoiceCount}"></div>
                        </div>
                        <div class="card-footer bg-light">
                            <a th:href="@{/invoices/details}" class="btn w-100">
                                Voir DÃ©tails
                            </a>
                        </div>
                    </div>
                </div>
            
                <div class="col-md-3">
                    <div class="card mb-3 text-center shadow">
                        <div class="card-header">
                            Total des Factures</h3>
                        </div>
                        <div class="card-body">
                            <div class="display-6 fw-bold text-dark" th:text="${invoiceTotal}"></div>
                        </div>
                        <div class="card-footer bg-light">
                            <a th:href="@{/invoices/details/total}" class="btn w-100 text-dark">
                                Voir DÃ©tails
                            </a>
                        </div>
                    </div>
                </div>
            
                <div class="col-md-3">
                    <div class="card mb-3 text-center shadow">
                        <div class="card-header">
                            Tout les Paiements</h3>
                        </div>
                        <div class="card-body">
                            <div class="display-6 fw-bold text-dark" th:text="${paymentTotal}"></div>
                        </div>
                        <div class="card-footer bg-light">
                            <a th:href="@{/payments/details}" class="btn w-100">
                                Voir DÃ©tails
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            
        </div>
        <!-- GRAPHIQUES -->
        <div class="card mb-4">
            <div class="card-body d-flex justify-content-around flex-wrap">
                <div>
                    <div class="card-header">
                        <h3>Repartition source de payment</h3>
                    </div>
                    <div class="card-body">    
                        <canvas id="pieChart" class="mb-3" width="300" height="400"></canvas>
                    </div>
                </div>
                <div>
                    <div class="card-header">
                        <h3>Total facture et montant payee par mois</h3>
                    </div>
                    <div class="card-body">    
                        <canvas id="barChart" class="mb-3" width="900" height="450"></canvas>
                    </div>
                </div>
                <div>
                    <div class="card-header">
                        <h3>Evolution du chiffre d'affaire annuelle</h3>
                    </div>
                    <div class="card-body">    
                        <canvas id="lineChart" class="mb-3" width="1300" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:insert="fragments/admin/footer :: footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function () {
            // ðŸ“Š Graphique en barres
            new Chart(document.getElementById('barChart'), {
                type: 'line',
                data: {
                    labels: /*[[${labels}]]*/,
                    datasets: [{
                        label: 'Facture',
                        data: /*[[${factureData}]]*/,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'PayÃ©e',
                        data: /*[[${payeeData}]]*/,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: { 
                    responsive: true
                }
            });
    
            new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
        labels: /*[[${pieLabels}]]*/,
        datasets: [{
            data: /*[[${pieData}]]*/,
            backgroundColor: [
                '#4BC0C0',  // Turquoise
                '#9966FF',  // Violet
                '#FF9F40',  // Orange
                '#FF6384',  // Rose
                '#36A2EB',  // Bleu clair
                '#FFCD56'   // Jaune
            ],
            borderColor: '#FFFFFF',  // Bordure blanche pour mieux sÃ©parer les sections
            borderWidth: 2
        }]
    },
    options: { 
        responsive: false,
        plugins: {
            legend: {
                position: 'right'  // Position de la lÃ©gende
            }
        }
    }
});
            new Chart(document.getElementById('lineChart'), {
                type: 'pie',
                data: {
                    labels: /*[[${lineLabels}]]*/,
                    datasets: [{
                        label: 'Chiffre affaire',
                        data: /*[[${lineData}]]*/,
                        fill: true,
                        backgroundColor: ['#3F51B5', '#009688', '#FFC107', '#E91E63'],
                        tension: 0.4
                    }]
                },
                options: { responsive: false }
            });
        });
    </script>
    
</body>
</html>
